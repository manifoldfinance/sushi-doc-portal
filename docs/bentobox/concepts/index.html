<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="search" type="application/opensearchdescription+xml" title="Sushiswap Kitchen" href="/opensearch.xml"><title data-rh="true">Bentobox - Concepts | Sushiswap Kitchen</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://sushi.com/docs/bentobox/concepts"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Bentobox - Concepts | Sushiswap Kitchen"><meta data-rh="true" name="description" content="The BentoBox is a vault that holds tokens and generate yield from flash loans"><meta data-rh="true" property="og:description" content="The BentoBox is a vault that holds tokens and generate yield from flash loans"><link data-rh="true" rel="icon" href="/img/favicon/favicon.ico"><link data-rh="true" rel="canonical" href="https://sushi.com/docs/bentobox/concepts"><link data-rh="true" rel="alternate" href="https://sushi.com/docs/bentobox/concepts" hreflang="en"><link data-rh="true" rel="alternate" href="https://sushi.com/docs/bentobox/concepts" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://XOPRM3IJU6-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b16f0b0c.css">
<link rel="preload" href="/assets/js/runtime~main.74dcbb19.js" as="script">
<link rel="preload" href="/assets/js/main.90418b06.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">üç£ Sushi</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">Guidebook</a><ul class="dropdown__menu"><li><a href="#" class="dropdown__link">Yield Farming and Strategies</a></li><li><a href="#" class="dropdown__link">Limit order protocol</a></li><li><a class="dropdown__link" href="/docs/onsen/masterchef/masterchef2">MasterChef v2</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">Protocols</a><ul class="dropdown__menu"><li><a href="#" class="dropdown__link">Sushiswap</a></li><li><a class="dropdown__link" href="/docs/onsen/masterchef/introduction">MasterChef</a></li><li><a href="#" class="dropdown__link">Trident</a></li><li><a class="dropdown__link" href="/docs/bentobox/concepts">BentoVault</a></li><li><a href="#" class="dropdown__link">Miso Launchpad</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="#" class="navbar__item navbar__link">Incentive Programs</a><a href="#" class="navbar__item navbar__link">Deploy Strategy</a><a href="https://www.npmjs.com/search?q=%40sushiswap" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>@sushiswap/sdk<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/sushiswap" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/miso/Introduction">Miso</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/miso/Introduction">Miso</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/miso/deployments">Sushi Contracts</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/onsen/masterchef/Introduction">Onsen</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/onsen/masterchef/Introduction">masterchef</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/bentobox/introduction">Bentobox</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/introduction">Bentobox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/bentobox/concepts">Bentobox - Concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/DEPLOYMENT">Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/DEVELOPMENT">Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/HISTORY">HISTORY (How it happened)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/IBentoBoxWithdraw">IBentoBoxWithdraw</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/IKashiWithdrawFee">IKashiWithdrawFee</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/IMigratorChef">IMigratorChef</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/MasterChef">MasterChef</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/MasterChefV2">MasterChefV2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/Migrator">Migrator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/MiniChefV2">MiniChefV2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/Multicall2">Multicall2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/Ownable">Ownable</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/OwnableData">OwnableData</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/SushiBar">SushiBar</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/SushiMaker">SushiMaker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/SushiMakerKashi">SushiMakerKashi</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/SushiRoll">SushiRoll</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bentobox/SushiToken">SushiToken</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/bentobox/bentobox/BaseBoringBatchable">bentobox</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/bentobox/governance/Timelock">governance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/bentobox/interfaces/IERC20">interfaces</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/bentobox/libraries/SafeERC20">libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/bentobox/mocks/CloneRewarderTime">mocks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/bentobox/uniswapv2/IMigrator">uniswapv2</a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/deployments">Sushi Contracts Deployments</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/kashi/getting-started">kashi</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">üè†</a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Bentobox</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/bentobox/concepts">Bentobox - Concepts</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Bentobox - Concepts</h1><blockquote><p>The BentoBox is a vault that holds tokens and generate yield from flash loans
and strategies for any protocol built on top of it.</p></blockquote><hr><p>The BentoBox is the main vault that holds all funds, not only for the lending
contracts, but also for any future extensions. Anyone can build extensions that
use the BentoBox as vault with these benefits:</p><ul><li><p>Once a token is approved for the Vault, any protocol built using BentoBox
doesn&#x27;t need per token approval anymore.</p></li><li><p>Low flat costs of internal token transfers and advanced transfers such as
one-to-many transfers.</p></li><li><p>Funds of users and protocols are safely separated internally. Only protocols
that the user approves can access the user&#x27;s funds.</p></li><li><p>Passive income from flash loans.</p></li><li><p>Potential passive income from strategies.</p></li></ul><p>Placing your tokens in a single vault brings a range of benefits. As more
protocols get added to the BentoBox, gas costs will come down, while
comparability, capital efficiency and flexibility will go up.</p><p>Not all tokens are created equal. Some have very high gas costs, some are not
quite ERC20 compliant. Once they are stored in the BentoBox, you can use your
tokens in any BentoBox enabled protocols. These protocols don&#x27;t have to worry
about any token quirks or handle ETH. The BentoBox takes care of all that. On
top of that, tokens in the BentoBox will generate extra returns through flash
loans and potentially a token strategy.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="mastercontracts-and-clones">MasterContracts and clones<a class="hash-link" href="#mastercontracts-and-clones" title="Direct link to heading">‚Äã</a></h2><p>Tokens in the BentoBox can be flash loaned. The fee is 0.05% and this fee goes
to the share owners in the BentoBox. Multiple assets can be flash loaned at the
same time.</p><p>ERC3156 wasn&#x27;t final at release of the BentoBox and the BentoBox is not ERC3156
compliant at this time. The BentoBox uses push instead of pull to get the
returned funds. This is for flexibility and security reasons.</p><p>The BentoBox has a simple strategy system per token. A strategy is a contract
that invests a single token for profit and returns the profit in that same
token. The safest strategies would be those that:</p><ul><li><p>Can only ever grow in token amount. Principal is always safe.</p></li><li><p>Can be deposited and withdraw at will.</p></li></ul><p>Some examples of this would be:</p><ul><li><p>The SushiBar: SUSHI can be invested and held as xSUSHI. See SushiStrategy.sol.</p></li><li><p>Staking contracts, such as MasterChef and Onsen.</p></li></ul><p>It will be up to the community and the Sushi team to decide which strategies are
safe enough to enable. The BentoBox has a hardcoded 2 weeks waiting period for
enabling or changing strategies.</p><p>When you deposit token in the BentoBox, you receive a number of shares. This
represents your shares of the total token amount in the BentoBox. As the amount
of tokens grows due to flash loan fees and profit from strategies, you will get
your share of that. Simple depositing tokens into the BentoBox can provide
returns.</p><p>Because of limited precision in the accounting, there will be small rounding
differences. For most tokens these will be incredibly small and have no useful
value. In the top 100 tokens, currently $XAUT is worth the most for a single
accounting unit, at about $0.00185. BentoBox is designed to never round in your
favour, because that could be exploited by clever hackers. But because of this,
when you deposit 100 tokens and withdraw it straight away, you may only receive
for instance 99.9999.</p><p>The batch function allows the batching of multiple BentoBox function calls in a
single transaction.</p><p>While most ERC20 tokens are supported by the BentoBox, there are some tokens
that should not be deposited into the BentoBox:</p><ul><li><p>Rebasing tokens are not directly supported. Since rebasing is just a visual
(psychological) trick rather than an actual feature, direct support was not
added. However, most rebasing tokens could easily be wrapped exposing the
underlying balances as an ERC20 token. These could be deposited into the
BentoBox without problem.</p></li><li><p>Tokens where a single &#x27;unit&#x27; has significant value. Due to rounding and gas
optimizations, it is possible to craft transactions that will give you &#x27;free&#x27;
units of a token. In case of a token, such as $SUSHI, with 18 decimals, this
would be worth about $0.00000000000000001. As long as gas costs are more than
this, it&#x27;s safe. In the case of WBTC, 1 unit is about $0.00033, which still
has a safety margin of about 4 orders of magnitude. There may however be some
tokens with low or no decimals and a high value that should not be added to
the BentoBox.</p></li><li><p>Tokens where the totalSupply in token units is greater than uint128, which is
about 38 decimals. With a maximum of 18 decimals normally used, this would
still allow for a totalSupply of 100.000.000.000.000.000.000, which is more
than enough. While ERC20 supports uint256, this limit was added to safe on
gas.</p></li></ul><p>To prevent a far-fetched grieving attack on the amount to share ratio, a minimum
of 1000 shares of each token have to remain in the BentoBox OR it has to be
emptied completely. Normally this is an insignificant amount, and even in case
of WBTC, it&#x27;s only $3.30. If you&#x27;re the last user, you can fully withdraw your
shares, so no funds are lost/inaccessible because of this.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="multiple-protocols-and-master-contracts">Multiple protocols and Master Contracts<a class="hash-link" href="#multiple-protocols-and-master-contracts" title="Direct link to heading">‚Äã</a></h2><p>Any protocol can use BentoBox as it&#x27;s storage of funds. The contract just needs
to implement the init function.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="approval-of-protocols-master-contracts-not-tokens">Approval of protocols (master contracts) not tokens<a class="hash-link" href="#approval-of-protocols-master-contracts-not-tokens" title="Direct link to heading">‚Äã</a></h2><p>For every new master contract, each user manually approves the protocol. Once
approved, functions of the protocol contract have access to all funds of the
user that are not in other protocols. Because this is quite a powerful approval,
users tricked into approving a malicious contract could lose a lot of funds. To
mitigate this and improve usability, the approval is done through a signed typed
data message. A wallet such as Metamask will display the typed data, which
includes this message:</p><p><code>Give FULL access to funds in (and approved to) BentoBox?</code></p><p>This will prompt users to the potential effects of the approval. Because some
hardware wallets are unable to sign typed data, such as the Ledger, a fallback
is available. The Sushi team has the ability to white-list master contracts so
they can be approved by a simple contract call.</p><p><code>mapping(IERC20 =&gt; mapping(address =&gt; uint256)) public balanceOf</code></p><p>The balance of shares per token per user (or contract).</p><p><code>mapping(IERC20 =&gt; Rebase) public totals</code></p><p>totals.elastic = actual total token balance in the BentoBox + the balance of
tokens sent to the strategy. totals.base = total shares (the sum of all the
balances of all users)</p><p><code>mapping(address =&gt; uint256) public nonces</code> mapping of nonces for user addresses</p><p><code>mapping(address =&gt; bool) public whitelistedMasterContracts</code> returns contracts
whitelisted to be approved in the fallback function</p><p>The <code>domainSeparator</code> function returns the domain separator.</p><p>Calls the permit function on a token confirming to
<a href="https://eips.ethereum.org/EIPS/eip-2612" target="_blank" rel="noopener noreferrer">EIP-2612</a>.</p><p>The <code>setMasterContractApproval</code> function allows users to approve all clones of a
masterContract to manage their funds using a typed message following the
<a href="https://eips.ethereum.org/EIPS/eip-712" target="_blank" rel="noopener noreferrer">EIP-712 standard</a>. To approve a master
contract <code>eth_signTypedData_v4</code> should be called with the appropriate data.</p><p>BentoBox also offers a fallback functionality targeted at Ledger devices which
only allows approving masterContracts whitelisted by the SushiSwap team. To use
the fallback, set the v, r, s values to 0.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="deposit-and-withdrawal-functions">Deposit and Withdrawal Functions<a class="hash-link" href="#deposit-and-withdrawal-functions" title="Direct link to heading">‚Äã</a></h2><p>Deposit and withdraw functions are used to add and remove funds from the
BentoBox. A range of different variants is available. Support for ERC721 permits
is also included, by batching a deposit with the <code>permit</code> function.</p><p>When depositing ETH, use the 0 address
(0x0000000000000000000000000000000000000000) and set the amount correctly. ETH
will be converted to WETH9 when depositing and back to ETH when withdrawn.
Setting a lower amount will cause a loss of ETH. This is not protected to
support batch deposits through the batch function.</p><p>Once a user approves a masterContract, all clones of that contract can withdraw
and deposit for that user.</p><p>The deposit function is used to add a BentoBox balance for a token to an address
(user or contract). This can be done in 2 ways:</p><ul><li><p>pulling in approved tokens using transferFrom</p></li><li><p>transfer the tokens onto the BentoBox contract address and use the BentoBox
contract address to &#x27;skim&#x27; the tokens to the &#x27;to&#x27; address.</p></li></ul><p>Inputs: <code>IERC20 token_</code> The contract address of the token being deposited. Use
<code>address(0)</code> for ETH. <code>address from</code> The address the tokens are coming from.
Must have permission. <code>address to</code> The address the BentoBox balance will be
assigned to. <code>uint256 amount</code> The amount of tokens being deposited. Only used if
<code>share</code> is 0. <code>uint256 share</code> The number of shares worth being deposited.
Calculated from <code>amount</code> when <code>share</code> is 0.</p><p>Outputs: <code>uint256 amountOut</code> The actual amount deposited. <code>uint256 shareOut</code> The
actual shares added.</p><p>Note: when the amount is calculated from the share and converting the amount
back to share results in less, amount is increased by 1. This is effectively
rounding up instead of down, to ensure the amount being added at a minimum
matches the value of the shares given.</p><p>Transfer functions are used to transfer funds from one account to another within
the BentoBox. Once a user approves a masterContract, all clones of that contract
can access the user&#x27;s funds in the BentoBox and transfer them.</p><p>The <code>transferMultiple</code> function does a one-to-many transfer in a more gas
efficient manner. Other complicated transfers can be composed through <code>batch</code>.</p><p>The batch function allows for executing multiple actions on the BentoBox
contract in a single transaction.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="free-token-units-due-to-rounding-fixed">Free token units due to rounding (fixed)<a class="hash-link" href="#free-token-units-due-to-rounding-fixed" title="Direct link to heading">‚Äã</a></h2><p>Due to rounding, it may be possible to deposit (or withdraw) a tiny amount of
tokens for &#x27;free&#x27;. Since these amounts would normally be worth nothing, the gas
costs to do this would make this pointless.</p><p>However, for tokens where a single &#x27;unit&#x27; has significant value this could be
problematic. These tokens should not be added to the BentoBox. In practice, this
is not an issue for nearly all popular tokens. Some examples, including the
worst cases from the CoinGecko top 100 Ethereum tokens:</p><p>$SUSHI - 18 decimals - $10 - single unit value is $0.00000000000000001 $WTB - 8
decimals - $33.000 - single unit value is $0.00033 $USDC - 6 decimals - $1 -
single unit value is $0.000001 $CEL - 4 decimals - $4,75 - single unit value is
$0.000475 $XAUT - 6 decimals - $1.850 - single unit value is $0.001850</p><p>As long as gas costs are more than this, it&#x27;s safe. In the case of WBTC, 1 unit
is about $0.00033, which still has a safety margin of about 4 orders of
magnitude. There may however be some tokens with low or no decimals and a high
value that should not be added to the BentoBox.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/manifoldfinance/sushi-doc-portal/edit/master/docs/bentobox/concepts.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/bentobox/introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Bentobox</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/bentobox/DEPLOYMENT"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deployment</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mastercontracts-and-clones" class="table-of-contents__link toc-highlight">MasterContracts and clones</a></li><li><a href="#multiple-protocols-and-master-contracts" class="table-of-contents__link toc-highlight">Multiple protocols and Master Contracts</a></li><li><a href="#approval-of-protocols-master-contracts-not-tokens" class="table-of-contents__link toc-highlight">Approval of protocols (master contracts) not tokens</a></li><li><a href="#deposit-and-withdrawal-functions" class="table-of-contents__link toc-highlight">Deposit and Withdrawal Functions</a></li><li><a href="#free-token-units-due-to-rounding-fixed" class="table-of-contents__link toc-highlight">Free token units due to rounding (fixed)</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.74dcbb19.js"></script>
<script src="/assets/js/main.90418b06.js"></script>
</body>
</html>